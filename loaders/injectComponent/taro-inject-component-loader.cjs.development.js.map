{"version":3,"file":"taro-inject-component-loader.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import generate from '@babel/generator'\r\nimport traverse from '@babel/traverse'\r\nimport utils from '@babel/types'\r\nimport { parse } from '@babel/parser'\r\nimport { getOptions } from 'loader-utils'\r\nimport { validate } from 'schema-utils'\r\n\r\nconst schema = {\r\n  type: 'object',\r\n  properties: {\r\n    importPath: {\r\n      type: 'string',\r\n    },\r\n    isPage: {\r\n      instanceof: 'Function',\r\n    },\r\n    componentName: {\r\n      type: 'string',\r\n    },\r\n  },\r\n  additionalProperties: false,\r\n}\r\n\r\nexport default function (source: string) {\r\n  // @ts-ignore\r\n  const webpackEnv = this\r\n\r\n  const options = getOptions(webpackEnv)\r\n\r\n  validate(schema as any, options, { name: 'taro-inject-component-loader' })\r\n\r\n  const { importPath = '', componentName = 'WebpackInjected', isPage = defaultJudgePage } = options || {}\r\n\r\n  // 获取原始文件地址\r\n  const filePath = webpackEnv.resourcePath\r\n\r\n  if (typeof isPage === 'function' && isPage(filePath)) {\r\n    // 生成 AST\r\n    const ast: any = parse(source, {\r\n      sourceType: 'module',\r\n      plugins: ['jsx', 'typescript', 'classProperties'],\r\n    })\r\n\r\n    // 如果有导入申明，则默认表示已手动导入了组件\r\n    let insert = false\r\n\r\n    // 保存所有顶层的声明\r\n    const declarations = new Map()\r\n\r\n    traverse(ast, {\r\n      // 查找是否有导入\r\n      ImportDeclaration(path) {\r\n        if (path.node.source.value === importPath) {\r\n          insert = true\r\n        }\r\n      },\r\n\r\n      // 收集页面文件里的所有申明\r\n      // 类组件\r\n      ClassDeclaration(path) {\r\n        // 如果不是顶层的申明，则直接返回\r\n        if (path.parent.type !== 'Program') return\r\n\r\n        const type = path.node.type\r\n        const name = path.node.id.name\r\n        declarations.set(name, type)\r\n      },\r\n\r\n      // 函数申明\r\n      FunctionDeclaration(path) {\r\n        // 如果不是顶层的申明，则直接返回\r\n        if (path.parent.type !== 'Program') return\r\n\r\n        const type = path.node.type\r\n        const name = path.node.id?.name\r\n        if (!name) return\r\n\r\n        declarations.set(name, type)\r\n      },\r\n\r\n      // 表达式申明\r\n      VariableDeclaration(path) {\r\n        // 如果不是顶层的申明，则直接返回\r\n        if (path.parent.type !== 'Program') return\r\n\r\n        path.node.declarations.forEach((declaration: any) => {\r\n\r\n          // const a = () => {}\r\n          if (declaration.init?.type === 'ArrowFunctionExpression') {\r\n            const type = declaration.init?.type\r\n            const name = declaration.id?.name\r\n            declarations.set(name, type)\r\n          }\r\n\r\n          // const a = function(){}\r\n          if (declaration.init?.type === 'FunctionExpression') {\r\n            const type = declaration.init.type\r\n            const name = declaration.id.name\r\n            declarations.set(name, type)\r\n          }\r\n\r\n          // const a = class {}\r\n          if (declaration.init?.type === 'ClassExpression') {\r\n            const type = declaration.init.type\r\n            const name = declaration.id.name\r\n            declarations.set(name, type)\r\n          }\r\n        })\r\n      },\r\n    })\r\n\r\n    if (!insert) {\r\n      // 记录组件插入状态\r\n      const state = {\r\n        importedDeclaration: false,\r\n        importedComponent: false,\r\n      }\r\n\r\n      traverse(ast, {\r\n        // 添加申明\r\n        ImportDeclaration(path) {\r\n          if (!state.importedDeclaration) {\r\n            state.importedDeclaration = true\r\n            path.insertBefore(\r\n              utils.importDeclaration(\r\n                [\r\n                  utils.importDefaultSpecifier(utils.identifier('' + componentName)),\r\n                ],\r\n                utils.stringLiteral('' + importPath),\r\n              ),\r\n            )\r\n          }\r\n        },\r\n\r\n        // 默认导出的为页面组件\r\n        ExportDefaultDeclaration(path) {\r\n\r\n          // 如果默认导出的是函数\r\n          if (path.node.declaration.type === 'FunctionDeclaration') {\r\n            const mainFnBody = path.node.declaration.body.body\r\n            const length = mainFnBody.length\r\n            const last = mainFnBody[length - 1]\r\n            insertComponent(last, '' + componentName, state)\r\n          }\r\n\r\n          // 默认导出箭头函数\r\n          if (path.node.declaration.type === 'ArrowFunctionExpression') {\r\n            // export default () => { return <View></View> }\r\n            if (path.node.declaration.body.type === 'BlockStatement') {\r\n              const mainFnBody = path.node.declaration.body.body\r\n              const length = mainFnBody.length\r\n              const last = mainFnBody[length - 1]\r\n              insertComponent(last, '' + componentName, state)\r\n            } else {\r\n              // export default () => <View></View>\r\n              insertComponent(path.node.declaration.body, '' + componentName, state)\r\n            }\r\n          }\r\n\r\n          // 默认导出类\r\n          if (path.node.declaration.type === 'ClassDeclaration') {\r\n            traverse(path.node, {\r\n              ClassMethod(path) {\r\n                if ((path.node.key as any).name === 'render') {\r\n                  const body = path.node.body.body || []\r\n                  const last = body[body.length - 1]\r\n                  insertComponent(last, '' + componentName, state)\r\n                  return\r\n                }\r\n              },\r\n            }, path.scope, path)\r\n          }\r\n\r\n          // 如果默认导出的是一个申明\r\n          if (path.node.declaration.type === \"Identifier\") {\r\n            const name = path.node.declaration.name\r\n            const componentType = declarations.get(name)\r\n\r\n            traverse(path.parent, {\r\n              FunctionDeclaration(path) {\r\n                if (path.node.id?.name !== name) return\r\n                const mainFnBody = path.node?.body?.body\r\n                const length = mainFnBody.length\r\n                const last = mainFnBody[length - 1]\r\n                insertComponent(last, '' + componentName, state)\r\n              },\r\n              ClassDeclaration(path) {\r\n                if (path.node.id.name !== name) return\r\n                traverse(path.node, {\r\n                  ClassMethod(path) {\r\n                    if ((path.node.key as any)?.name !== 'render') return\r\n                    const body = path.node.body.body || []\r\n                    const last = body[body.length - 1]\r\n                    insertComponent(last, '' + componentName, state)\r\n                  },\r\n                }, path.scope, path)\r\n              },\r\n              VariableDeclarator(path) {\r\n                if (path.node.id.type !== 'Identifier') return\r\n                if (path.node.id.name !== name) return\r\n                if (!path.node.init) return\r\n\r\n                if (path.node.init.type !== componentType) return\r\n\r\n                if (path.node.init.type === 'FunctionExpression') {\r\n                  const mainFnBody = path.node.init.body.body\r\n                  const length = mainFnBody.length\r\n                  const last = mainFnBody[length - 1]\r\n                  insertComponent(last, '' + componentName, state)\r\n                }\r\n\r\n                if (path.node.init.type === 'ClassExpression') {\r\n                  traverse(path.node, {\r\n                    ClassMethod(path) {\r\n                      if ((path.node.key as any).name !== 'render') return\r\n                      const body = path.node.body.body || []\r\n                      const last = body[body.length - 1]\r\n                      insertComponent(last, '' + componentName, state)\r\n                    },\r\n                  }, path.scope, path)\r\n                }\r\n\r\n                if (path.node.init.type === 'ArrowFunctionExpression') {\r\n                  // const A = () => {}\r\n                  // export default A\r\n                  if (path.node.init.body.type == 'BlockStatement') {\r\n                    const mainFnBody = path.node.init.body.body\r\n                    const length = mainFnBody.length\r\n                    const last = mainFnBody[length - 1]\r\n                    insertComponent(last, '' + componentName, state)\r\n                  } else {\r\n                    // const A = () => <div></div>\r\n                    // export default A\r\n                    insertComponent(path.node.init.body, '' + componentName, state)\r\n                  }\r\n                }\r\n              }\r\n            })\r\n          }\r\n        },\r\n      })\r\n\r\n      if (!state.importedComponent) {\r\n        webpackEnv.emitWarning(`页面: ${filePath} 注入组件失败，建议手动引入组件。组件注入限制请查阅: https://github.com/xdoer/taro-inject-component-loader`)\r\n\r\n      }\r\n      if (!state.importedDeclaration) {\r\n        webpackEnv.emitWarning(`页面: ${filePath} 注入导入申明失败，建议手动引入组件。组件注入限制请查阅: https://github.com/xdoer/taro-inject-component-loader`)\r\n      }\r\n\r\n      source = generate(ast).code\r\n    }\r\n  }\r\n\r\n  return source\r\n}\r\n\r\n\r\nfunction createElement(name: string) {\r\n  const reactIdentifier = utils.identifier('React')\r\n  const createElementIdentifier = utils.identifier('createElement')\r\n  const callee = utils.memberExpression(reactIdentifier, createElementIdentifier)\r\n  return utils.callExpression(callee, [utils.identifier(name)])\r\n}\r\n\r\nfunction createJSX(name: string) {\r\n  return utils.jSXElement(\r\n    utils.jSXOpeningElement(utils.jsxIdentifier('' + name), [], true),\r\n    null,\r\n    [],\r\n    true,\r\n  )\r\n}\r\n\r\nfunction insertComponent(node: any, componentName: string, state: any) {\r\n  if (node?.type === 'ReturnStatement') {\r\n    // createElement\r\n    if (node.argument?.callee?.property?.name === 'createElement' && !state.importedComponent) {\r\n      state.importedComponent = true\r\n      const reactCreateArguments = node.argument.arguments\r\n      reactCreateArguments.push(createElement(componentName))\r\n    }\r\n    // JSX\r\n    if (node.argument?.type === 'JSXElement' && !state.importedComponent) {\r\n      state.importedComponent = true\r\n      node.argument.children.push(createJSX(componentName))\r\n    }\r\n  }\r\n  if (node.type === 'JSXElement' && !state.importedComponent) {\r\n    state.importedComponent = true\r\n    node.children.push(createJSX(componentName))\r\n  }\r\n}\r\n\r\nfunction defaultJudgePage(filePath: string) {\r\n  // 兼容 windows 路径\r\n  const formatFilePath = filePath.replace(/\\\\/g, '/')\r\n  return /(package-.+\\/)?pages\\/[A-Za-z0-9-]+\\/index\\.[tj]sx$/.test(formatFilePath)\r\n}\r\n"],"names":["schema","type","properties","importPath","isPage","componentName","additionalProperties","source","webpackEnv","options","getOptions","validate","name","defaultJudgePage","filePath","resourcePath","ast","parse","sourceType","plugins","insert","declarations","Map","traverse","ImportDeclaration","path","node","value","ClassDeclaration","parent","id","set","FunctionDeclaration","VariableDeclaration","forEach","declaration","init","state","importedDeclaration","importedComponent","insertBefore","utils","importDeclaration","importDefaultSpecifier","identifier","stringLiteral","ExportDefaultDeclaration","mainFnBody","body","length","last","insertComponent","ClassMethod","key","scope","componentType","get","VariableDeclarator","emitWarning","generate","code","createElement","reactIdentifier","createElementIdentifier","callee","memberExpression","callExpression","createJSX","jSXElement","jSXOpeningElement","jsxIdentifier","argument","property","reactCreateArguments","arguments","push","children","formatFilePath","replace","test"],"mappings":";;;;;;;;;;;;;AAOA,IAAMA,MAAM,GAAG;AACbC,EAAAA,IAAI,EAAE,QADO;AAEbC,EAAAA,UAAU,EAAE;AACVC,IAAAA,UAAU,EAAE;AACVF,MAAAA,IAAI,EAAE;AADI,KADF;AAIVG,IAAAA,MAAM,EAAE;AACN,oBAAY;AADN,KAJE;AAOVC,IAAAA,aAAa,EAAE;AACbJ,MAAAA,IAAI,EAAE;AADO;AAPL,GAFC;AAabK,EAAAA,oBAAoB,EAAE;AAbT,CAAf;gBAgByBC;AACvB;AACA,MAAMC,UAAU,GAAG,IAAnB;AAEA,MAAMC,OAAO,GAAGC,sBAAU,CAACF,UAAD,CAA1B;AAEAG,EAAAA,oBAAQ,CAACX,MAAD,EAAgBS,OAAhB,EAAyB;AAAEG,IAAAA,IAAI,EAAE;AAAR,GAAzB,CAAR;;AAEA,aAA0FH,OAAO,IAAI,EAArG;AAAA,6BAAQN,UAAR;AAAA,MAAQA,UAAR,gCAAqB,EAArB;AAAA,gCAAyBE,aAAzB;AAAA,MAAyBA,aAAzB,mCAAyC,iBAAzC;AAAA,yBAA4DD,MAA5D;AAAA,MAA4DA,MAA5D,4BAAqES,gBAArE;;;AAGA,MAAMC,QAAQ,GAAGN,UAAU,CAACO,YAA5B;;AAEA,MAAI,OAAOX,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACU,QAAD,CAA1C,EAAsD;AACpD;AACA,QAAME,GAAG,GAAQC,YAAK,CAACV,MAAD,EAAS;AAC7BW,MAAAA,UAAU,EAAE,QADiB;AAE7BC,MAAAA,OAAO,EAAE,CAAC,KAAD,EAAQ,YAAR,EAAsB,iBAAtB;AAFoB,KAAT,CAAtB,CAFoD;;AAQpD,QAAIC,MAAM,GAAG,KAAb,CARoD;;AAWpD,QAAMC,YAAY,GAAG,IAAIC,GAAJ,EAArB;AAEAC,IAAAA,QAAQ,CAACP,GAAD,EAAM;AACZ;AACAQ,MAAAA,iBAFY,6BAEMC,IAFN;AAGV,YAAIA,IAAI,CAACC,IAAL,CAAUnB,MAAV,CAAiBoB,KAAjB,KAA2BxB,UAA/B,EAA2C;AACzCiB,UAAAA,MAAM,GAAG,IAAT;AACD;AACF,OANW;AAQZ;AACA;AACAQ,MAAAA,gBAVY,4BAUKH,IAVL;AAWV;AACA,YAAIA,IAAI,CAACI,MAAL,CAAY5B,IAAZ,KAAqB,SAAzB,EAAoC;AAEpC,YAAMA,IAAI,GAAGwB,IAAI,CAACC,IAAL,CAAUzB,IAAvB;AACA,YAAMW,IAAI,GAAGa,IAAI,CAACC,IAAL,CAAUI,EAAV,CAAalB,IAA1B;AACAS,QAAAA,YAAY,CAACU,GAAb,CAAiBnB,IAAjB,EAAuBX,IAAvB;AACD,OAjBW;AAmBZ;AACA+B,MAAAA,mBApBY,+BAoBQP,IApBR;;;AAqBV;AACA,YAAIA,IAAI,CAACI,MAAL,CAAY5B,IAAZ,KAAqB,SAAzB,EAAoC;AAEpC,YAAMA,IAAI,GAAGwB,IAAI,CAACC,IAAL,CAAUzB,IAAvB;AACA,YAAMW,IAAI,oBAAGa,IAAI,CAACC,IAAL,CAAUI,EAAb,qBAAG,cAAclB,IAA3B;AACA,YAAI,CAACA,IAAL,EAAW;AAEXS,QAAAA,YAAY,CAACU,GAAb,CAAiBnB,IAAjB,EAAuBX,IAAvB;AACD,OA7BW;AA+BZ;AACAgC,MAAAA,mBAhCY,+BAgCQR,IAhCR;AAiCV;AACA,YAAIA,IAAI,CAACI,MAAL,CAAY5B,IAAZ,KAAqB,SAAzB,EAAoC;AAEpCwB,QAAAA,IAAI,CAACC,IAAL,CAAUL,YAAV,CAAuBa,OAAvB,CAA+B,UAACC,WAAD;;;AAE7B;AACA,cAAI,sBAAAA,WAAW,CAACC,IAAZ,uCAAkBnC,IAAlB,MAA2B,yBAA/B,EAA0D;AAAA;;AACxD,gBAAMA,IAAI,yBAAGkC,WAAW,CAACC,IAAf,qBAAG,mBAAkBnC,IAA/B;AACA,gBAAMW,IAAI,sBAAGuB,WAAW,CAACL,EAAf,qBAAG,gBAAgBlB,IAA7B;AACAS,YAAAA,YAAY,CAACU,GAAb,CAAiBnB,IAAjB,EAAuBX,IAAvB;AACD;;;AAGD,cAAI,uBAAAkC,WAAW,CAACC,IAAZ,wCAAkBnC,IAAlB,MAA2B,oBAA/B,EAAqD;AACnD,gBAAMA,KAAI,GAAGkC,WAAW,CAACC,IAAZ,CAAiBnC,IAA9B;AACA,gBAAMW,KAAI,GAAGuB,WAAW,CAACL,EAAZ,CAAelB,IAA5B;AACAS,YAAAA,YAAY,CAACU,GAAb,CAAiBnB,KAAjB,EAAuBX,KAAvB;AACD;;;AAGD,cAAI,uBAAAkC,WAAW,CAACC,IAAZ,wCAAkBnC,IAAlB,MAA2B,iBAA/B,EAAkD;AAChD,gBAAMA,MAAI,GAAGkC,WAAW,CAACC,IAAZ,CAAiBnC,IAA9B;AACA,gBAAMW,MAAI,GAAGuB,WAAW,CAACL,EAAZ,CAAelB,IAA5B;AACAS,YAAAA,YAAY,CAACU,GAAb,CAAiBnB,MAAjB,EAAuBX,MAAvB;AACD;AACF,SAtBD;AAuBD;AA3DW,KAAN,CAAR;;AA8DA,QAAI,CAACmB,MAAL,EAAa;AACX;AACA,UAAMiB,KAAK,GAAG;AACZC,QAAAA,mBAAmB,EAAE,KADT;AAEZC,QAAAA,iBAAiB,EAAE;AAFP,OAAd;AAKAhB,MAAAA,QAAQ,CAACP,GAAD,EAAM;AACZ;AACAQ,QAAAA,iBAFY,6BAEMC,IAFN;AAGV,cAAI,CAACY,KAAK,CAACC,mBAAX,EAAgC;AAC9BD,YAAAA,KAAK,CAACC,mBAAN,GAA4B,IAA5B;AACAb,YAAAA,IAAI,CAACe,YAAL,CACEC,KAAK,CAACC,iBAAN,CACE,CACED,KAAK,CAACE,sBAAN,CAA6BF,KAAK,CAACG,UAAN,CAAiB,KAAKvC,aAAtB,CAA7B,CADF,CADF,EAIEoC,KAAK,CAACI,aAAN,CAAoB,KAAK1C,UAAzB,CAJF,CADF;AAQD;AACF,SAdW;AAgBZ;AACA2C,QAAAA,wBAjBY,oCAiBarB,IAjBb;AAmBV;AACA,cAAIA,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBlC,IAAtB,KAA+B,qBAAnC,EAA0D;AACxD,gBAAM8C,UAAU,GAAGtB,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBa,IAAtB,CAA2BA,IAA9C;AACA,gBAAMC,MAAM,GAAGF,UAAU,CAACE,MAA1B;AACA,gBAAMC,IAAI,GAAGH,UAAU,CAACE,MAAM,GAAG,CAAV,CAAvB;AACAE,YAAAA,eAAe,CAACD,IAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACD;;;AAGD,cAAIZ,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBlC,IAAtB,KAA+B,yBAAnC,EAA8D;AAC5D;AACA,gBAAIwB,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBa,IAAtB,CAA2B/C,IAA3B,KAAoC,gBAAxC,EAA0D;AACxD,kBAAM8C,WAAU,GAAGtB,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBa,IAAtB,CAA2BA,IAA9C;AACA,kBAAMC,OAAM,GAAGF,WAAU,CAACE,MAA1B;AACA,kBAAMC,KAAI,GAAGH,WAAU,CAACE,OAAM,GAAG,CAAV,CAAvB;AACAE,cAAAA,eAAe,CAACD,KAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACD,aALD,MAKO;AACL;AACAc,cAAAA,eAAe,CAAC1B,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBa,IAAvB,EAA6B,KAAK3C,aAAlC,EAAiDgC,KAAjD,CAAf;AACD;AACF;;;AAGD,cAAIZ,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBlC,IAAtB,KAA+B,kBAAnC,EAAuD;AACrDsB,YAAAA,QAAQ,CAACE,IAAI,CAACC,IAAN,EAAY;AAClB0B,cAAAA,WADkB,uBACN3B,IADM;AAEhB,oBAAKA,IAAI,CAACC,IAAL,CAAU2B,GAAV,CAAsBzC,IAAtB,KAA+B,QAApC,EAA8C;AAC5C,sBAAMoC,IAAI,GAAGvB,IAAI,CAACC,IAAL,CAAUsB,IAAV,CAAeA,IAAf,IAAuB,EAApC;AACA,sBAAME,MAAI,GAAGF,IAAI,CAACA,IAAI,CAACC,MAAL,GAAc,CAAf,CAAjB;AACAE,kBAAAA,eAAe,CAACD,MAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACA;AACD;AACF;AARiB,aAAZ,EASLZ,IAAI,CAAC6B,KATA,EASO7B,IATP,CAAR;AAUD;;;AAGD,cAAIA,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBlC,IAAtB,KAA+B,YAAnC,EAAiD;AAC/C,gBAAMW,IAAI,GAAGa,IAAI,CAACC,IAAL,CAAUS,WAAV,CAAsBvB,IAAnC;AACA,gBAAM2C,aAAa,GAAGlC,YAAY,CAACmC,GAAb,CAAiB5C,IAAjB,CAAtB;AAEAW,YAAAA,QAAQ,CAACE,IAAI,CAACI,MAAN,EAAc;AACpBG,cAAAA,mBADoB,+BACAP,IADA;;;AAElB,oBAAI,mBAAAA,IAAI,CAACC,IAAL,CAAUI,EAAV,oCAAclB,IAAd,MAAuBA,IAA3B,EAAiC;AACjC,oBAAMmC,UAAU,iBAAGtB,IAAI,CAACC,IAAR,wCAAG,WAAWsB,IAAd,qBAAG,gBAAiBA,IAApC;AACA,oBAAMC,MAAM,GAAGF,UAAU,CAACE,MAA1B;AACA,oBAAMC,IAAI,GAAGH,UAAU,CAACE,MAAM,GAAG,CAAV,CAAvB;AACAE,gBAAAA,eAAe,CAACD,IAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACD,eAPmB;AAQpBT,cAAAA,gBARoB,4BAQHH,IARG;AASlB,oBAAIA,IAAI,CAACC,IAAL,CAAUI,EAAV,CAAalB,IAAb,KAAsBA,IAA1B,EAAgC;AAChCW,gBAAAA,QAAQ,CAACE,IAAI,CAACC,IAAN,EAAY;AAClB0B,kBAAAA,WADkB,uBACN3B,IADM;;;AAEhB,wBAAK,mBAAAA,IAAI,CAACC,IAAL,CAAU2B,GAAV,oCAAuBzC,IAAvB,MAAgC,QAArC,EAA+C;AAC/C,wBAAMoC,IAAI,GAAGvB,IAAI,CAACC,IAAL,CAAUsB,IAAV,CAAeA,IAAf,IAAuB,EAApC;AACA,wBAAME,IAAI,GAAGF,IAAI,CAACA,IAAI,CAACC,MAAL,GAAc,CAAf,CAAjB;AACAE,oBAAAA,eAAe,CAACD,IAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACD;AANiB,iBAAZ,EAOLZ,IAAI,CAAC6B,KAPA,EAOO7B,IAPP,CAAR;AAQD,eAlBmB;AAmBpBgC,cAAAA,kBAnBoB,8BAmBDhC,IAnBC;AAoBlB,oBAAIA,IAAI,CAACC,IAAL,CAAUI,EAAV,CAAa7B,IAAb,KAAsB,YAA1B,EAAwC;AACxC,oBAAIwB,IAAI,CAACC,IAAL,CAAUI,EAAV,CAAalB,IAAb,KAAsBA,IAA1B,EAAgC;AAChC,oBAAI,CAACa,IAAI,CAACC,IAAL,CAAUU,IAAf,EAAqB;AAErB,oBAAIX,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAenC,IAAf,KAAwBsD,aAA5B,EAA2C;;AAE3C,oBAAI9B,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAenC,IAAf,KAAwB,oBAA5B,EAAkD;AAChD,sBAAM8C,YAAU,GAAGtB,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAeY,IAAf,CAAoBA,IAAvC;AACA,sBAAMC,QAAM,GAAGF,YAAU,CAACE,MAA1B;AACA,sBAAMC,MAAI,GAAGH,YAAU,CAACE,QAAM,GAAG,CAAV,CAAvB;AACAE,kBAAAA,eAAe,CAACD,MAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACD;;AAED,oBAAIZ,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAenC,IAAf,KAAwB,iBAA5B,EAA+C;AAC7CsB,kBAAAA,QAAQ,CAACE,IAAI,CAACC,IAAN,EAAY;AAClB0B,oBAAAA,WADkB,uBACN3B,IADM;AAEhB,0BAAKA,IAAI,CAACC,IAAL,CAAU2B,GAAV,CAAsBzC,IAAtB,KAA+B,QAApC,EAA8C;AAC9C,0BAAMoC,IAAI,GAAGvB,IAAI,CAACC,IAAL,CAAUsB,IAAV,CAAeA,IAAf,IAAuB,EAApC;AACA,0BAAME,IAAI,GAAGF,IAAI,CAACA,IAAI,CAACC,MAAL,GAAc,CAAf,CAAjB;AACAE,sBAAAA,eAAe,CAACD,IAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACD;AANiB,mBAAZ,EAOLZ,IAAI,CAAC6B,KAPA,EAOO7B,IAPP,CAAR;AAQD;;AAED,oBAAIA,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAenC,IAAf,KAAwB,yBAA5B,EAAuD;AACrD;AACA;AACA,sBAAIwB,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAeY,IAAf,CAAoB/C,IAApB,IAA4B,gBAAhC,EAAkD;AAChD,wBAAM8C,YAAU,GAAGtB,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAeY,IAAf,CAAoBA,IAAvC;AACA,wBAAMC,QAAM,GAAGF,YAAU,CAACE,MAA1B;AACA,wBAAMC,MAAI,GAAGH,YAAU,CAACE,QAAM,GAAG,CAAV,CAAvB;AACAE,oBAAAA,eAAe,CAACD,MAAD,EAAO,KAAK7C,aAAZ,EAA2BgC,KAA3B,CAAf;AACD,mBALD,MAKO;AACL;AACA;AACAc,oBAAAA,eAAe,CAAC1B,IAAI,CAACC,IAAL,CAAUU,IAAV,CAAeY,IAAhB,EAAsB,KAAK3C,aAA3B,EAA0CgC,KAA1C,CAAf;AACD;AACF;AACF;AA1DmB,aAAd,CAAR;AA4DD;AACF;AAzHW,OAAN,CAAR;;AA4HA,UAAI,CAACA,KAAK,CAACE,iBAAX,EAA8B;AAC5B/B,QAAAA,UAAU,CAACkD,WAAX,oBAA8B5C,QAA9B;AAED;;AACD,UAAI,CAACuB,KAAK,CAACC,mBAAX,EAAgC;AAC9B9B,QAAAA,UAAU,CAACkD,WAAX,oBAA8B5C,QAA9B;AACD;;AAEDP,MAAAA,MAAM,GAAGoD,QAAQ,CAAC3C,GAAD,CAAR,CAAc4C,IAAvB;AACD;AACF;;AAED,SAAOrD,MAAP;AACD;;AAGD,SAASsD,aAAT,CAAuBjD,IAAvB;AACE,MAAMkD,eAAe,GAAGrB,KAAK,CAACG,UAAN,CAAiB,OAAjB,CAAxB;AACA,MAAMmB,uBAAuB,GAAGtB,KAAK,CAACG,UAAN,CAAiB,eAAjB,CAAhC;AACA,MAAMoB,MAAM,GAAGvB,KAAK,CAACwB,gBAAN,CAAuBH,eAAvB,EAAwCC,uBAAxC,CAAf;AACA,SAAOtB,KAAK,CAACyB,cAAN,CAAqBF,MAArB,EAA6B,CAACvB,KAAK,CAACG,UAAN,CAAiBhC,IAAjB,CAAD,CAA7B,CAAP;AACD;;AAED,SAASuD,SAAT,CAAmBvD,IAAnB;AACE,SAAO6B,KAAK,CAAC2B,UAAN,CACL3B,KAAK,CAAC4B,iBAAN,CAAwB5B,KAAK,CAAC6B,aAAN,CAAoB,KAAK1D,IAAzB,CAAxB,EAAwD,EAAxD,EAA4D,IAA5D,CADK,EAEL,IAFK,EAGL,EAHK,EAIL,IAJK,CAAP;AAMD;;AAED,SAASuC,eAAT,CAAyBzB,IAAzB,EAAoCrB,aAApC,EAA2DgC,KAA3D;AACE,MAAI,CAAAX,IAAI,QAAJ,YAAAA,IAAI,CAAEzB,IAAN,MAAe,iBAAnB,EAAsC;AAAA;;AACpC;AACA,QAAI,mBAAAyB,IAAI,CAAC6C,QAAL,6DAAeP,MAAf,qEAAuBQ,QAAvB,4CAAiC5D,IAAjC,MAA0C,eAA1C,IAA6D,CAACyB,KAAK,CAACE,iBAAxE,EAA2F;AACzFF,MAAAA,KAAK,CAACE,iBAAN,GAA0B,IAA1B;AACA,UAAMkC,oBAAoB,GAAG/C,IAAI,CAAC6C,QAAL,CAAcG,SAA3C;AACAD,MAAAA,oBAAoB,CAACE,IAArB,CAA0Bd,aAAa,CAACxD,aAAD,CAAvC;AACD,KANmC;;;AAQpC,QAAI,oBAAAqB,IAAI,CAAC6C,QAAL,qCAAetE,IAAf,MAAwB,YAAxB,IAAwC,CAACoC,KAAK,CAACE,iBAAnD,EAAsE;AACpEF,MAAAA,KAAK,CAACE,iBAAN,GAA0B,IAA1B;AACAb,MAAAA,IAAI,CAAC6C,QAAL,CAAcK,QAAd,CAAuBD,IAAvB,CAA4BR,SAAS,CAAC9D,aAAD,CAArC;AACD;AACF;;AACD,MAAIqB,IAAI,CAACzB,IAAL,KAAc,YAAd,IAA8B,CAACoC,KAAK,CAACE,iBAAzC,EAA4D;AAC1DF,IAAAA,KAAK,CAACE,iBAAN,GAA0B,IAA1B;AACAb,IAAAA,IAAI,CAACkD,QAAL,CAAcD,IAAd,CAAmBR,SAAS,CAAC9D,aAAD,CAA5B;AACD;AACF;;AAED,SAASQ,gBAAT,CAA0BC,QAA1B;AACE;AACA,MAAM+D,cAAc,GAAG/D,QAAQ,CAACgE,OAAT,CAAiB,KAAjB,EAAwB,GAAxB,CAAvB;AACA,SAAO,sDAAsDC,IAAtD,CAA2DF,cAA3D,CAAP;AACD;;;;"}